<div class="relative" x-data="{ filterSlide : false }">
    <div class="px-4 py-8 z-0" :class="{ 'blur-xs z-120 pointer-events-none': filterSlide }">
        <div class="w-full">
            <a 
                href="{{ routes.collections_url }}"
                class="text-base text-gray-500 hover:underline text-center block my-4 w-40 mx-auto"
            >
                Go to collections
            </a>
        </div>

        
        {% paginate collection.products by section.settings.number_of_products_per_page %}
            <h1 class="text-3xl text-center">{{ collection.title }}</h1>
            <div class="max-w-6xl mx-auto">
                <div class="w-auto top-0 left-0 my-4">
                    <button 
                        @click="filterSlide = true"
                        type="button"
                        class="w-26 flex justify-between shadow-xl text-black py-2 ml-3 pl-4 pr-6 rounded-md cursor-pointer border-1"
                    >
                        {% render 'icon-filter-horizontal' %}
                        <span>filters</span>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {% for product in collection.products %}
                        {% render 'product-card', product_item: product %}
                    {% else %}
                        <p class="md:col-span-3 text-center py-20">Sorry, there is no product inside of the collection.</p>
                    {% endfor %}
                </div>
            </div> 

            {% render 'pagination', pagination: paginate %}

        {% endpaginate %}
    </div>

    <aside 
        x-show="filterSlide"
        @click.away="filterSlide = false"
        @keydown.escape.window="filterSlide = false"
        x-transition:enter="transition transform duration-300 ease-out"
        x-transition:enter-start="-translate-x-full"
        x-transition:enter-end="translate-x-0"
        x-transition:leave="transition transform duration-300 ease-in"
        x-transition:leave-start="translate-x-0"
        x-transition:leave-end="-translate-x-full"
        x-cloak
        class="fixed top-0 left-0 w-64 h-screen bg-white shadow z-[110]"
    >
        <div class="sticky top-0 p-6 overflow-y-auto h-screen">
            <h2 class="text-lg font-semibold mb-4">Filter Products</h2>

            {% comment %} 
            Build unique option names and values 
            {% endcomment %}

            {% assign option_values = '' %}
            {% assign vendors = '' %}
            {% assign option_name = '' %}

            {% for product in collection.products %}
                {% assign vendors = vendors | append: product.vendor | append: ',' %}

                {% for option in product.options_with_values %}
                    {% case forloop.index %}
                        {% when 2 %}
                            {% assign option_name = option.name %}
                            {% for value in option.values %}
                                {% unless option_values contains value %}
                                    {% assign option_values = option_values | append: value | append: ',' %}
                                {% endunless %}
                            {% endfor %}
                    {% endcase %}
                {% endfor %}
            {% endfor %}

            {% assign option_array = option_values | split: ',' | uniq %}
            {% assign vendor_array = vendors | split: ',' | uniq %}

            {% if option_name != '' %}
                <div class="mb-6">
                    <h3 class="text-sm font-medium text-gray-700 mb-2">{{ option_name }}</h3>
                    <div class="flex flex-wrap gap-2">
                        {% for value in option_array %}
                            {% if value != '' %}
                                <button 
                                    type="button"
                                    class="variant-filter-btn px-3 py-1 border rounded text-sm hover:bg-gray-100"
                                    data-filter-name="{{ option_name | downcase }}"
                                    data-filter-value="{{ value }}"
                                >
                                    {{ value }}
                                </button>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            <div class="mb-6">
                <h3 class="text-sm font-medium text-gray-700 mb-2">Vendor</h3>
                <div class="flex flex-wrap gap-2">
                    {% for vendor in vendor_array %}
                        {% if vendor != '' %}
                            <button 
                                type="button"
                                class="variant-filter-btn px-3 py-1 border rounded text-sm hover:bg-gray-100"
                                data-filter-name="vendor"
                                data-filter-value="{{ vendor }}"
                            >
                                {{ vendor }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </aside>
</div>

{% schema %}
{
    "name": "Template Collection",
    "settings": [
        {
            "type": "number",
            "id": "number_of_products_per_page",
            "default": 6,
            "label": "Number of products per page"
        }
    ]
}
{% endschema %}